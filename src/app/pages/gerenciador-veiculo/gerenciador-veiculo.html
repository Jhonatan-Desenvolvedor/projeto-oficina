<div class="page-hero mb-4">
  <div>
    <p class="eyebrow">Frota · Veículos</p>
    <h1 class="hero-title">Gerenciar Veículos</h1>
    <p class="muted">Cadastre, edite e organize os veículos vinculados aos clientes.</p>
  </div>
  <div class="actions">
    <button class="btn primary" (click)="abrirModalNovo()"><i class="bi bi-car-front-fill"></i> Novo Veículo</button>
  </div>
</div>

<div class="card panel shadow-sm border-0 rounded-4 p-3 mb-4">
  <div class="row g-3 align-items-center">
    <div class="col-md-6">
      <label class="label-custom">Placa, Modelo ou Marca</label>
      <div class="input-with-icon">
        <i class="bi bi-search"></i>
        <input type="text" class="form-control input-custom" placeholder="Buscar..." [ngModel]="filtroPlaca()" (ngModelChange)="filtroPlaca.set($event)">
      </div>
    </div>
    <div class="col-md-6 text-end">
      <span class="pill">{{ veiculosFiltrados().length }} veículos</span>
    </div>
  </div>
</div>

<div class="card table-card shadow-lg border-0 rounded-4">
  <div class="table-responsive">
    <table class="table align-middle mb-0">
      <thead>
        <tr>
          <th class="text-center">Placa</th>
          <th>Veículo</th>
          <th class="text-center">Cor</th>
          <th>Proprietário</th>
          <th class="text-center">Ano</th>
          <th class="text-center">Ações</th>
        </tr>
      </thead>
      <tbody>
        @for (v of veiculosFiltrados(); track v.id) {
        <tr>
          <td class="text-center"><span class="badge plate">{{v.placa}}</span></td>
          <td>
            <div class="fw-bold text-dark">{{v.marca}}</div>
            <div class="muted small">{{v.modelo}}</div>
          </td>
          <td class="text-center"><span class="badge cor">{{v.cor || '—'}}</span></td>
          <td>
            <div class="fw-bold text-dark">{{v.cliente?.nome || 'NÃO ATRIBUÍDO'}}</div>
            <div class="muted small">{{v.cliente?.telefone}}</div>
          </td>
          <td class="text-center">{{v.ano}}</td>
          <td class="text-center">
            <div class="btn-group">
              <button class="icon-btn edit" (click)="prepararEdicao(v)"><i class="bi bi-pencil"></i></button>
              <button class="icon-btn delete" (click)="confirmarExclusao(v.id)"><i class="bi bi-trash"></i></button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Novo Veículo -->
<div class="modal fade" id="modalNovoVeiculo" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-5 border-0 shadow-lg">
      <div class="modal-header gradient text-white p-4">
        <h5 class="modal-title fw-bold">Cadastrar Veículo</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="label-custom">Cliente (obrigatório)</label>
            <select class="form-select input-custom" [(ngModel)]="veiculoNovo().clienteId" required>
              <option [ngValue]="null" disabled>Selecione...</option>
              @for (c of clientes(); track c.id) {
                <option [ngValue]="c.id">{{c.nome}} - {{c.telefone}}</option>
              }
            </select>
          </div>
          <div class="col-md-3">
            <label class="label-custom">Marca</label>
            <input type="text" class="form-control input-custom" [(ngModel)]="veiculoNovo().marca">
          </div>
          <div class="col-md-3">
            <label class="label-custom">Modelo</label>
            <input type="text" class="form-control input-custom" [(ngModel)]="veiculoNovo().modelo">
          </div>
          <div class="col-md-3">
            <label class="label-custom">Placa</label>
            <input type="text" class="form-control input-custom text-uppercase" maxlength="7" [(ngModel)]="veiculoNovo().placa">
          </div>
          <div class="col-md-3">
            <label class="label-custom">Cor</label>
            <input type="text" class="form-control input-custom" [(ngModel)]="veiculoNovo().cor">
          </div>
          <div class="col-md-3">
            <label class="label-custom">Ano</label>
            <input type="number" class="form-control input-custom" [(ngModel)]="veiculoNovo().ano">
          </div>
        </div>
      </div>
      <div class="modal-footer border-0 p-4 bg-light">
        <button class="btn ghost" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn primary" [disabled]="!veiculoNovo().clienteId" (click)="salvarNovoVeiculo()" data-bs-dismiss="modal">Salvar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Editar Veículo -->
<div class="modal fade" id="modalVeiculo" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-5 border-0 shadow-lg" *ngIf="veiculoSelecionado() as v">
      <div class="modal-header gradient text-white p-4">
        <h5 class="modal-title fw-bold">Editar Veículo</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="label-custom">Marca</label>
            <input type="text" class="form-control input-custom" [(ngModel)]="v.marca">
          </div>
          <div class="col-md-6">
            <label class="label-custom">Modelo</label>
            <input type="text" class="form-control input-custom" [(ngModel)]="v.modelo">
          </div>
          <div class="col-md-6">
            <label class="label-custom">Placa</label>
            <input type="text" class="form-control input-custom text-uppercase" maxlength="7" [(ngModel)]="v.placa">
          </div>
          <div class="col-md-6">
            <label class="label-custom">Cor</label>
            <input type="text" class="form-control input-custom" [(ngModel)]="v.cor">
          </div>
          <div class="col-md-6">
            <label class="label-custom">Ano</label>
            <input type="number" class="form-control input-custom" [(ngModel)]="v.ano">
          </div>
        </div>
      </div>
      <div class="modal-footer border-0 p-4 bg-light">
        <button class="btn ghost" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn primary" (click)="salvarEdicao()" data-bs-dismiss="modal">Salvar</button>
      </div>
    </div>
  </div>
</div>
